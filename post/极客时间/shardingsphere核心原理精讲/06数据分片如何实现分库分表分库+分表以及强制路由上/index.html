<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>06æ•°æ®åˆ†ç‰‡ï¼šå¦‚ä½•å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†åº“&#43;åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ï¼Ÿï¼ˆä¸Šï¼‰ - Docs</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="" /><meta name="description" content="é€šè¿‡å‰é¢å‡ ä¸ªè¯¾æ—¶çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ ShardingSphere å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘å°†å¸¦é¢†ä½ é€šè¿‡æ¡ˆä¾‹åˆ†æé€æ­¥æŒæ¡ ShardingSphere çš„å„é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨æœºåˆ¶ã€‚
å•åº“å•è¡¨ç³»ç»Ÿ
" /><meta name="keywords" content="æŠ€æœ¯æ–‡æ¡£, docs, æå®¢æ—¶é—´" />






<meta name="generator" content="Hugo 0.140.2 with theme even" />


<link rel="canonical" href="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/06%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%88%86%E5%BA%93&#43;%E5%88%86%E8%A1%A8%E4%BB%A5%E5%8F%8A%E5%BC%BA%E5%88%B6%E8%B7%AF%E7%94%B1%E4%B8%8A/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="https://politcloud.org/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/06%E6%95%B0%E6%8D%AE%E5%88%86%E7%89%87%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%88%86%E5%BA%93&#43;%E5%88%86%E8%A1%A8%E4%BB%A5%E5%8F%8A%E5%BC%BA%E5%88%B6%E8%B7%AF%E7%94%B1%E4%B8%8A/">
  <meta property="og:site_name" content="Docs">
  <meta property="og:title" content="06æ•°æ®åˆ†ç‰‡ï¼šå¦‚ä½•å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†åº“&#43;åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ï¼Ÿï¼ˆä¸Šï¼‰">
  <meta property="og:description" content="é€šè¿‡å‰é¢å‡ ä¸ªè¯¾æ—¶çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ ShardingSphere å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘å°†å¸¦é¢†ä½ é€šè¿‡æ¡ˆä¾‹åˆ†æé€æ­¥æŒæ¡ ShardingSphere çš„å„é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨æœºåˆ¶ã€‚
å•åº“å•è¡¨ç³»ç»Ÿ">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-10T00:00:00+00:00">
    <meta property="article:tag" content="ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²">

  <meta itemprop="name" content="06æ•°æ®åˆ†ç‰‡ï¼šå¦‚ä½•å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†åº“&#43;åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ï¼Ÿï¼ˆä¸Šï¼‰">
  <meta itemprop="description" content="é€šè¿‡å‰é¢å‡ ä¸ªè¯¾æ—¶çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ ShardingSphere å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘å°†å¸¦é¢†ä½ é€šè¿‡æ¡ˆä¾‹åˆ†æé€æ­¥æŒæ¡ ShardingSphere çš„å„é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨æœºåˆ¶ã€‚
å•åº“å•è¡¨ç³»ç»Ÿ">
  <meta itemprop="datePublished" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-01-10T00:00:00+00:00">
  <meta itemprop="wordCount" content="7493">
  <meta itemprop="keywords" content="ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="06æ•°æ®åˆ†ç‰‡ï¼šå¦‚ä½•å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†åº“&#43;åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ï¼Ÿï¼ˆä¸Šï¼‰">
  <meta name="twitter:description" content="é€šè¿‡å‰é¢å‡ ä¸ªè¯¾æ—¶çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ ShardingSphere å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘å°†å¸¦é¢†ä½ é€šè¿‡æ¡ˆä¾‹åˆ†æé€æ­¥æŒæ¡ ShardingSphere çš„å„é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨æœºåˆ¶ã€‚
å•åº“å•è¡¨ç³»ç»Ÿ">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Docs</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Docs</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">06æ•°æ®åˆ†ç‰‡ï¼šå¦‚ä½•å®ç°åˆ†åº“ã€åˆ†è¡¨ã€åˆ†åº“&#43;åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ï¼Ÿï¼ˆä¸Šï¼‰</h1>

      <div class="post-meta">
        <span class="post-time"> 10100-01-10 </span>
        <div class="post-category">
            <a href="/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> æå®¢æ—¶é—´ </a>
            </div>
          <span class="more-meta"> çº¦ 7493 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 15 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents"></nav>
  </div>
</div>
    <div class="post-content">
      <p>é€šè¿‡å‰é¢å‡ ä¸ªè¯¾æ—¶çš„ä»‹ç»ï¼Œç›¸ä¿¡ä½ å¯¹ ShardingSphere å·²ç»æœ‰äº†åˆæ­¥äº†è§£ã€‚ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘å°†å¸¦é¢†ä½ é€šè¿‡æ¡ˆä¾‹åˆ†æé€æ­¥æŒæ¡ ShardingSphere çš„å„é¡¹æ ¸å¿ƒåŠŸèƒ½ï¼Œé¦–å½“å…¶å†²çš„å°±æ˜¯åˆ†åº“åˆ†è¡¨æœºåˆ¶ã€‚</p>
<p>å•åº“å•è¡¨ç³»ç»Ÿ</p>
<p>æˆ‘ä»¬å…ˆä»å•åº“å•è¡¨ç³»ç»Ÿè¯´èµ·ã€‚åœ¨æ•´ä¸ªè¯¾ç¨‹ä¸­ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šå¼ºè°ƒï¼Œæˆ‘ä»¬å°†é»˜è®¤ä½¿ç”¨ Spring Boot é›†æˆå’Œ ShardingSphere æ¡†æ¶ï¼ŒåŒæ—¶åŸºäº Mybatis å®ç°å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚</p>
<p>å¯¼å…¥å¼€å‘æ¡†æ¶</p>
<p>ç³»ç»Ÿå¼€å‘çš„ç¬¬ä¸€æ­¥æ˜¯å¯¼å…¥æ‰€éœ€çš„å¼€å‘æ¡†æ¶ã€‚åœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ª Spring Boot ä»£ç å·¥ç¨‹ï¼Œåœ¨ pom æ–‡ä»¶ä¸­éœ€è¦æ·»åŠ å¯¹ sharding-jdbc-spring-boot-starter å’Œ mybatis-spring-boot-starter è¿™ä¸¤ä¸ª starter çš„å¼•ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;dependency&gt;
</span></span><span class="line"><span class="cl">Â Â Â &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
</span></span><span class="line"><span class="cl">Â Â Â &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;
</span></span><span class="line"><span class="cl">&lt;/dependency&gt;
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">&lt;dependency&gt;
</span></span><span class="line"><span class="cl">Â Â Â Â &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
</span></span><span class="line"><span class="cl">Â Â Â Â &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
</span></span><span class="line"><span class="cl">&lt;/dependency&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¼€å‘ç¯å¢ƒåˆå§‹åŒ–è¦åšçš„å·¥ä½œä¹Ÿå°±æ˜¯è¿™äº›ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»æ¡ˆä¾‹çš„ä¸šåŠ¡åœºæ™¯ã€‚</p>
<p>æ¢³ç†ä¸šåŠ¡åœºæ™¯</p>
<p>æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªåœ¨åŒ»ç–—å¥åº·é¢†åŸŸä¸­æ¯”è¾ƒå¸¸è§çš„ä¸šåŠ¡åœºæ™¯ã€‚åœ¨è¿™ç±»åœºæ™¯ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·ï¼ˆUserï¼‰éƒ½æœ‰ä¸€ä»½å¥åº·è®°å½•ï¼ˆHealthRecordï¼‰ï¼Œå­˜å‚¨ç€ä»£è¡¨ç”¨æˆ·å½“å‰å¥åº·çŠ¶å†µçš„å¥åº·ç­‰çº§ï¼ˆHealthLevelï¼‰ï¼Œä»¥åŠä¸€ç³»åˆ—å¥åº·ä»»åŠ¡ï¼ˆHealthTaskï¼‰ã€‚é€šå¸¸ï¼ŒåŒ»ç”Ÿé€šè¿‡ç”¨æˆ·å½“å‰çš„å¥åº·è®°å½•åˆ›å»ºä¸åŒçš„å¥åº·ä»»åŠ¡ï¼Œç„¶åç”¨æˆ·å¯ä»¥é€šè¿‡å®ŒæˆåŒ»ç”Ÿæ‰€æŒ‡å®šçš„ä»»åŠ¡æ¥è·å–ä¸€å®šçš„å¥åº·ç§¯åˆ†ï¼Œè€Œè¿™ä¸ªç§¯åˆ†å†³å®šäº†ç”¨æˆ·çš„å¥åº·ç­‰çº§ï¼Œå¹¶æœ€ç»ˆå½±å“åˆ°æ•´ä¸ªå¥åº·è®°å½•ã€‚å¥åº·ä»»åŠ¡åšå¾—è¶Šå¤šï¼Œå¥åº·ç­‰çº§å°±è¶Šé«˜ï¼Œç”¨æˆ·çš„å¥åº·è®°å½•ä¹Ÿå°±è¶Šå®Œå–„ï¼Œåè¿‡æ¥å¥åº·ä»»åŠ¡ä¹Ÿå°±å¯ä»¥è¶Šåšè¶Šå°‘ï¼Œä»è€Œå½¢æˆä¸€ä¸ªæ­£å‘çš„ä¸šåŠ¡é—­ç¯ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ— æ„å¯¹æ•´ä¸ªä¸šåŠ¡é—­ç¯åšè¿‡å¤šçš„é˜è¿°ï¼Œè€Œæ˜¯å…³æ³¨è¿™ä¸€ä¸šåŠ¡åœºæ™¯ä¸‹å‡ ä¸ªæ ¸å¿ƒä¸šåŠ¡å¯¹è±¡çš„å­˜å‚¨å’Œè®¿é—®æ–¹å¼ã€‚</p>
<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å…³æ³¨ Userã€HealthRecordã€HealthLevel å’Œ HealthTask è¿™å››ä¸ªä¸šåŠ¡å¯¹è±¡ã€‚åœ¨ä¸‹é¢è¿™å¼ å›¾ä¸­ï¼Œå¯¹æ¯ä¸ªä¸šåŠ¡å¯¹è±¡ç»™å‡ºæœ€åŸºç¡€çš„å­—æ®µå®šä¹‰ï¼Œä»¥åŠè¿™å››ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³è”å…³ç³»ï¼š</p>
<p>å®ŒæˆåŸºç¡€åŠŸèƒ½</p>
<p>æ—¢ç„¶é‡‡ç”¨ Mybatis ä½œä¸º ORM æ¡†æ¶ï¼Œé‚£ä¹ˆå°±éœ€è¦éµå¾ª Mybatis çš„å¼€å‘æµç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå„ä¸ªä¸šåŠ¡å®ä½“çš„å®šä¹‰ï¼š</p>
<p>ä¸šåŠ¡å®ä½“çš„ç±»å®šä¹‰</p>
<p>åŸºäºè¿™äº›ä¸šåŠ¡å®ä½“ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆå¯¹åº”çš„ Mapper æ–‡ä»¶ç¼–å†™ï¼Œæˆ‘æŠŠè¿™äº› Mapper æ–‡ä»¶æ”¾åœ¨ä»£ç å·¥ç¨‹çš„ resources ç›®å½•ä¸‹ï¼š</p>
<p>Mybatis Mapper æ–‡ä»¶å®šä¹‰</p>
<p>ä¸‹ä¸€æ­¥æ˜¯æ•°æ®æºä¿¡æ¯çš„é…ç½®ï¼Œæˆ‘ä»¬æŠŠè¿™äº›ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ application-traditional.properties é…ç½®æ–‡ä»¶ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.datasource.driverClassName = com.mysql.jdbc.Driver
</span></span><span class="line"><span class="cl">spring.datasource.url = jdbc:mysql://localhost:3306/ds
</span></span><span class="line"><span class="cl">spring.datasource.username = root
</span></span><span class="line"><span class="cl">spring.datasource.password = root
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‰ç…§ Spring Boot çš„é…ç½®çº¦å®šï¼Œæˆ‘ä»¬åœ¨ application.properties é…ç½®æ–‡ä»¶ä¸­æŠŠä¸Šè¿°é…ç½®æ–‡ä»¶è®¾ç½®ä¸ºå¯åŠ¨ profileã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„ profileï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆä¸åŒé…ç½®ä½“ç³»ä¹‹é—´çš„åˆ‡æ¢ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.profiles.active=traditional
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…å°±æ˜¯åˆ›å»º Repository å±‚ç»„ä»¶ï¼š</p>
<p>Repository å±‚æ¥å£å®šä¹‰</p>
<p>æœ€åï¼Œæˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº†ç›¸å…³çš„ä¸‰ä¸ªæœåŠ¡ç±»ï¼Œåˆ†åˆ«æ˜¯ UserServiceã€HealthLevelService å’Œ HealthRecordServiceã€‚</p>
<p>Service å±‚æ¥å£å’Œå®ç°ç±»å®šä¹‰</p>
<p>é€šè¿‡ UserServiceï¼Œæˆ‘ä»¬ä¼šæ’å…¥ä¸€æ‰¹ç”¨æˆ·æ•°æ®ç”¨äºå®Œæˆç”¨æˆ·ä¿¡æ¯çš„åˆå§‹åŒ–ã€‚ç„¶åï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª HealthLevelServiceï¼Œä¸“é—¨ç”¨æ¥åˆå§‹åŒ–å¥åº·ç­‰çº§ä¿¡æ¯ã€‚è¯·æ³¨æ„ï¼Œä¸å…¶ä»–ä¸šåŠ¡å¯¹è±¡ä¸åŒï¼Œå¥åº·ç­‰çº§ä¿¡æ¯æ˜¯ç³»ç»Ÿä¸­çš„ä¸€ç§å…¸å‹å­—å…¸ä¿¡æ¯ï¼Œæˆ‘ä»¬å‡å®šç³»ç»Ÿä¸­å­˜åœ¨ 5 ç§å¥åº·ç­‰çº§ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„æœåŠ¡å°±æ˜¯ HealthRecordServiceï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å®Œæˆ HealthRecord ä»¥åŠ HealthTask æ•°æ®çš„å­˜å‚¨å’Œè®¿é—®ã€‚è¿™é‡Œä»¥ HealthRecordService æœåŠ¡ä¸ºä¾‹ï¼Œä¸‹é¢è¿™æ®µä»£ç ç»™å‡ºäº†å®ƒçš„å®ç°è¿‡ç¨‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@Service
</span></span><span class="line"><span class="cl">public class HealthRecordServiceImpl implements HealthRecordService { 
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">Â Â Â  @Autowired
</span></span><span class="line"><span class="cl">Â Â Â  private HealthRecordRepository healthRecordRepository;
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">Â Â Â  @Autowired
</span></span><span class="line"><span class="cl">Â Â Â  private HealthTaskRepository healthTaskRepository;
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">Â Â Â  @Override
</span></span><span class="line"><span class="cl">Â Â Â  public void processHealthRecords() throws SQLException{
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â  insertHealthRecords();
</span></span><span class="line"><span class="cl">Â Â Â  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Â Â Â  private List&lt;Integer&gt; insertHealthRecords() throws SQLException {
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â  List&lt;Integer&gt; result = new ArrayList&lt;&gt;(10);
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â  for (int i = 1; i &lt;= 10; i++) {
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â   HealthRecord healthRecord = insertHealthRecord(i);
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â Â Â Â Â  insertHealthTask(i, healthRecord);
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â Â Â Â Â  result.add(healthRecord.getRecordId());
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â  }
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â  return result;
</span></span><span class="line"><span class="cl">Â Â Â  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Â Â Â  private HealthRecord insertHealthRecord(final int i) throws SQLException {
</span></span><span class="line"><span class="cl">Â Â Â   HealthRecord healthRecord = new HealthRecord();
</span></span><span class="line"><span class="cl">Â Â Â   healthRecord.setUserId(i);
</span></span><span class="line"><span class="cl">Â Â Â   healthRecord.setLevelId(i % 5);
</span></span><span class="line"><span class="cl">Â Â Â   healthRecord.setRemark(&#34;Remark&#34; + i);
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â  healthRecordRepository.addEntity(healthRecord);
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â Â  return healthRecord;
</span></span><span class="line"><span class="cl">Â Â Â  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Â Â Â  private void insertHealthTask(final int i, final HealthRecord healthRecord) throws SQLException {
</span></span><span class="line"><span class="cl">Â Â Â   HealthTask healthTask = new HealthTask();
</span></span><span class="line"><span class="cl">Â Â Â   healthTask.setRecordId(healthRecord.getRecordId());
</span></span><span class="line"><span class="cl">Â Â Â   healthTask.setUserId(i);
</span></span><span class="line"><span class="cl">Â Â Â   healthTask.setTaskName(&#34;TaskName&#34; + i);
</span></span><span class="line"><span class="cl">Â Â Â   healthTaskRepository.addEntity(healthTask);
</span></span><span class="line"><span class="cl">Â Â Â  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä»é›¶å¼€å§‹å®ç°äº†ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡åœºæ™¯æ‰€éœ€è¦çš„ DAO å±‚å’Œ Service å±‚ç»„ä»¶ã€‚è¿™äº›ç»„ä»¶åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šéƒ½éå¸¸ç®€å•ï¼Œè€Œåœ¨æŠ€æœ¯ä¸Šä¹Ÿæ˜¯å®Œå…¨é‡‡ç”¨äº† Mybatis çš„ç»å…¸å¼€å‘è¿‡ç¨‹ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ç»„ç®€å•çš„å•å…ƒæµ‹è¯•æ¥éªŒè¯è¿™äº›ç»„ä»¶æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ä¸‹é¢è¿™æ®µä»£ç ä»¥ UserServiceTest ç±»ä¸ºä¾‹ç»™å‡ºå®ƒçš„å®ç°ï¼Œæ¶‰åŠ @RunWithã€@SpringBootTest ç­‰å¸¸è§å•å…ƒæµ‹è¯•æ³¨è§£çš„ä½¿ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@RunWith(SpringRunner.class)
</span></span><span class="line"><span class="cl">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)
</span></span><span class="line"><span class="cl">public class UserServiceTest {
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">Â Â Â  @Autowired
</span></span><span class="line"><span class="cl">Â Â Â  private UserService userService;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Â Â Â  @Test
</span></span><span class="line"><span class="cl">Â Â Â  public void testProcessUsers() throws Exception {
</span></span><span class="line"><span class="cl">Â Â Â Â Â Â  userService.processUsers();
</span></span><span class="line"><span class="cl">Â Â Â  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿è¡Œè¿™ä¸ªå•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æµ‹è¯•é€šè¿‡ï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“çš„ User è¡¨ä¸­ä¹Ÿçœ‹åˆ°äº†æ’å…¥çš„æ•°æ®ã€‚è‡³æ­¤ï¼Œä¸€ä¸ªå•åº“å•è¡¨çš„ç³»ç»Ÿå·²ç»æ„å»ºå®Œæˆã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å¯¹è¿™ä¸ªç³»ç»Ÿåšåˆ†åº“åˆ†è¡¨æ”¹é€ ã€‚</p>
<p>åœ¨ä¼ ç»Ÿå•åº“å•è¡¨çš„æ•°æ®æ¶æ„ä¸Šè¿›è¡Œåˆ†åº“åˆ†è¡¨çš„æ”¹é€ ï¼Œå¼€å‘äººå‘˜åªéœ€è¦åšä¸€ä»¶äº‹æƒ…ï¼Œé‚£å°±æ˜¯åŸºäºä¸Šä¸€è¯¾æ—¶ä»‹ç»çš„ ShardingSphere é…ç½®ä½“ç³»å®Œæˆé’ˆå¯¹å…·ä½“åœºæ™¯çš„é…ç½®å·¥ä½œå³å¯ï¼Œæ‰€æœ‰å·²ç»å­˜åœ¨çš„ä¸šåŠ¡ä»£ç éƒ½ä¸éœ€è¦åšä»»ä½•çš„å˜åŠ¨ï¼Œè¿™å°±æ˜¯ ShardingSphere çš„å¼ºå¤§ä¹‹å¤„ã€‚è®©æˆ‘ä»¬ä¸€èµ·å¼€å§‹å§ã€‚</p>
<p>ç³»ç»Ÿæ”¹é€ ï¼šå¦‚ä½•å®ç°åˆ†åº“ï¼Ÿ</p>
<p>ä½œä¸ºç³»ç»Ÿæ”¹é€ çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹å¦‚ä½•åŸºäºé…ç½®ä½“ç³»å®ç°æ•°æ®çš„åˆ†åº“è®¿é—®ã€‚</p>
<p>åˆå§‹åŒ–æ•°æ®æº</p>
<p>é’ˆå¯¹åˆ†åº“åœºæ™¯ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸¤ä¸ªæ•°æ®åº“ï¼Œåˆ†åˆ«å« ds0 å’Œ ds1ã€‚æ˜¾ç„¶ï¼Œé’ˆå¯¹ä¸¤ä¸ªæ•°æ®æºï¼Œæˆ‘ä»¬å°±éœ€è¦åˆå§‹åŒ–ä¸¤ä¸ª DataSource å¯¹è±¡ï¼Œè¿™ä¸¤ä¸ª DataSource å¯¹è±¡å°†ç»„æˆä¸€ä¸ª Map å¹¶ä¼ é€’ç»™ ShardingDataSourceFactory å·¥å‚ç±»ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.shardingsphere.datasource.names=ds0,ds1
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds0.type=com.alibaba.druid.pool.DruidDataSource
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds0.driver-class-name=com.mysql.jdbc.Driver
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds0.url=jdbc:mysql://localhost:3306/ds0
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds0.username=root
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds0.password=root
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds1.type=com.alibaba.druid.pool.DruidDataSource
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds1.driver-class-name=com.mysql.jdbc.Driver
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds1.url=jdbc:mysql://localhost:3306/ds1
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds1.username=root
</span></span><span class="line"><span class="cl">spring.shardingsphere.datasource.ds1.password=root
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¾ç½®åˆ†ç‰‡ç­–ç•¥</p>
<p>æ˜ç¡®äº†æ•°æ®æºä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®é’ˆå¯¹åˆ†åº“çš„åˆ†ç‰‡ç­–ç•¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.shardingsphere.sharding.default-database-strategy.inline.sharding-column=user_id
</span></span><span class="line"><span class="cl">spring.shardingsphere.sharding.default-database-strategy.inline.algorithm-expression=ds$-&gt;{user_id % 2}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ ShardingSphere ä¸­å­˜åœ¨ä¸€ç»„ ShardingStrategyConfigurationï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯åŸºäºè¡Œè¡¨è¾¾å¼çš„ InlineShardingStrategyConfigurationã€‚InlineShardingStrategyConfiguration åŒ…å«ä¸¤ä¸ªéœ€è¦è®¾ç½®çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯æŒ‡å®šåˆ†ç‰‡åˆ—åç§°çš„ shardingColumnï¼Œå¦ä¸€ä¸ªæ˜¯æŒ‡å®šåˆ†ç‰‡ç®—æ³•è¡Œè¡¨è¾¾å¼çš„ algorithmExpressionã€‚åœ¨æˆ‘ä»¬çš„é…ç½®æ–¹æ¡ˆä¸­ï¼Œå°†åŸºäº user_id åˆ—å¯¹ 2 çš„å–æ¨¡å€¼æ¥ç¡®å®šæ•°æ®åº”è¯¥å­˜å‚¨åœ¨å“ªä¸€ä¸ªæ•°æ®åº“ä¸­ã€‚åŒæ—¶ï¼Œæ³¨æ„åˆ°è¿™é‡Œé…ç½®çš„æ˜¯â€œdefault-database-strategyâ€é¡¹ã€‚ç»“åˆä¸Šä¸€è¯¾æ—¶çš„å†…å®¹ï¼Œè®¾ç½®è¿™ä¸ªé…ç½®é¡¹ç›¸å½“äºæ˜¯åœ¨ ShardingRuleConfiguration ä¸­æŒ‡å®šäº†é»˜è®¤çš„åˆ†åº“ ShardingStrategyã€‚</p>
<p>è®¾ç½®ç»‘å®šè¡¨å’Œå¹¿æ’­è¡¨</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è®¾ç½®ç»‘å®šè¡¨ã€‚ç»‘å®šè¡¨ï¼ˆBindingTableï¼‰æ˜¯ ShardingSphere ä¸­æå‡ºçš„ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œæˆ‘æ¥ç»™ä½ è§£é‡Šä¸€ä¸‹ã€‚</p>
<p>æ‰€è°“ç»‘å®šè¡¨ï¼Œæ˜¯æŒ‡ä¸åˆ†ç‰‡è§„åˆ™ä¸€è‡´çš„ä¸€ç»„ä¸»è¡¨å’Œå­è¡¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œhealth_record è¡¨å’Œ health_task è¡¨ä¸­éƒ½å­˜åœ¨ä¸€ä¸ª record_id å­—æ®µã€‚å¦‚æœæˆ‘ä»¬åœ¨åº”ç”¨è¿‡ç¨‹ä¸­æŒ‰ç…§è¿™ä¸ª record_id å­—æ®µè¿›è¡Œåˆ†ç‰‡ï¼Œé‚£ä¹ˆè¿™ä¸¤å¼ è¡¨å°±å¯ä»¥æ„æˆäº’ä¸ºç»‘å®šè¡¨å…³ç³»ã€‚</p>
<p>å¼•å…¥ç»‘å®šè¡¨æ¦‚å¿µçš„æ ¹æœ¬åŸå› åœ¨äºï¼Œäº’ä¸ºç»‘å®šè¡¨å…³ç³»çš„å¤šè¡¨å…³è”æŸ¥è¯¢ä¸ä¼šå‡ºç°ç¬›å¡å°”ç§¯ï¼Œå› æ­¤å…³è”æŸ¥è¯¢æ•ˆç‡å°†å¤§å¤§æå‡ã€‚ä¸¾ä¾‹è¯´æ˜ï¼Œå¦‚æœæ‰€æ‰§è¡Œçš„ä¸ºä¸‹é¢è¿™æ¡ SQLï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT record.remark_name FROM health_record record JOIN health_task task ON record.record_id=task.record_id WHERE record.record_id in (1, 2);
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœæˆ‘ä»¬ä¸æ˜¾å¼é…ç½®ç»‘å®šè¡¨å…³ç³»ï¼Œå‡è®¾åˆ†ç‰‡é”® record_id å°†å€¼ 1 è·¯ç”±è‡³ç¬¬ 1 ç‰‡ï¼Œå°†æ•°å€¼ 2 è·¯ç”±è‡³ç¬¬ 0 ç‰‡ï¼Œé‚£ä¹ˆè·¯ç”±åçš„ SQL åº”è¯¥ä¸º 4 æ¡ï¼Œå®ƒä»¬å‘ˆç°ä¸ºç¬›å¡å°”ç§¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT record.remark_name FROM health_record0 record JOIN health_task0 task ON record.record_id=task.record_id WHERE record.record_id in (1, 2);
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">SELECT record.remark_name FROM health_record0 record JOIN health_task1 task ON record.record_id=task.record_id WHERE record.record_id in (1, 2);
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">SELECT record.remark_name FROM health_record1 record JOIN health_task0 task ON record.record_id=task.record_id WHERE record.record_id in (1, 2);
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">SELECT record.remark_name FROM health_record1 record JOIN health_task1 task ON record.record_id=task.record_id WHERE record.record_id in (1, 2);
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œåœ¨é…ç½®ç»‘å®šè¡¨å…³ç³»åï¼Œè·¯ç”±çš„ SQL å°±ä¼šå‡å°‘åˆ° 2 æ¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">SELECT record.remark_name FROM health_record0 record JOIN health_task0 task ON record.record_id=task.record_id WHERE record.record_id in (1, 2);
</span></span><span class="line"><span class="cl">Â 
</span></span><span class="line"><span class="cl">SELECT record.remark_name FROM health_record1 record JOIN health_task1 task ON record.record_id=task.record_id WHERE record.record_id in (1, 2);
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯·æ³¨æ„ï¼Œå¦‚æœæƒ³è¦è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œäº’ä¸ºç»‘å®šè¡¨çš„å„ä¸ªè¡¨çš„åˆ†ç‰‡é”®è¦å®Œå…¨ç›¸åŒã€‚åœ¨ä¸Šé¢çš„è¿™äº› SQL è¯­å¥ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºï¼Œè¿™ä¸ªéœ€è¦å®Œå…¨ç›¸åŒçš„åˆ†ç‰‡é”®å°±æ˜¯ record_idã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°æ¡ˆä¾‹ä¸­çš„åœºæ™¯ï¼Œæ˜¾ç„¶ï¼Œhealth_record å’Œ health_task åº”è¯¥äº’ä¸ºç»‘å®šè¡¨å…³ç³»ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹è¿™ç§å…³ç³»çš„é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.shardingsphere.sharding.binding-tables=health_record, health_task
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»‹ç»å®Œç»‘å®šè¡¨ï¼Œå†æ¥çœ‹å¹¿æ’­è¡¨çš„æ¦‚å¿µã€‚æ‰€è°“å¹¿æ’­è¡¨ï¼ˆBroadCastTableï¼‰ï¼Œæ˜¯æŒ‡æ‰€æœ‰åˆ†ç‰‡æ•°æ®æºä¸­éƒ½å­˜åœ¨çš„è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§è¡¨çš„è¡¨ç»“æ„å’Œè¡¨ä¸­çš„æ•°æ®åœ¨æ¯ä¸ªæ•°æ®åº“ä¸­éƒ½æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚å¹¿æ’­è¡¨çš„é€‚ç”¨åœºæ™¯æ¯”è¾ƒæ˜ç¡®ï¼Œé€šå¸¸é’ˆå¯¹æ•°æ®é‡ä¸å¤§ä¸”éœ€è¦ä¸æµ·é‡æ•°æ®è¡¨è¿›è¡Œå…³è”æŸ¥è¯¢çš„åº”ç”¨åœºæ™¯ï¼Œå…¸å‹çš„ä¾‹å­å°±æ˜¯æ¯ä¸ªåˆ†ç‰‡æ•°æ®åº“ä¸­éƒ½åº”è¯¥å­˜åœ¨çš„å­—å…¸è¡¨ã€‚</p>
<p>åŒæ ·å›åˆ°æˆ‘ä»¬çš„åœºæ™¯ï¼Œå¯¹äº health_level è¡¨è€Œè¨€ï¼Œç”±äºå®ƒä¿å­˜ç€æœ‰é™çš„å¥åº·ç­‰çº§ä¿¡æ¯ï¼Œå¯ä»¥è®¤ä¸ºå®ƒå°±æ˜¯è¿™æ ·çš„ä¸€ç§å­—å…¸è¡¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†å¯¹å¹¿æ’­è¡¨çš„å®šä¹‰ï¼Œåœ¨ä¸‹é¢è¿™æ®µä»£ç ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.shardingsphere.sharding.broadcast-tables=health_level
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¾ç½®è¡¨åˆ†ç‰‡è§„åˆ™</p>
<p>é€šè¿‡å‰é¢çš„è¿™äº›é…ç½®é¡¹ï¼Œæˆ‘ä»¬æ ¹æ®éœ€æ±‚å®Œæˆäº† ShardingRuleConfiguration ä¸­ä¸åˆ†åº“æ“ä½œç›¸å…³çš„é…ç½®ä¿¡æ¯è®¾ç½®ã€‚æˆ‘ä»¬çŸ¥é“ ShardingRuleConfiguration ä¸­çš„ TableRuleConfiguration æ˜¯å¿…å¡«é¡¹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ä¸‹åº”è¯¥å¦‚ä½•å¯¹è¡¨åˆ†ç‰‡è¿›è¡Œè®¾ç½®ã€‚</p>
<p>TableRuleConfiguration æ˜¯è¡¨åˆ†ç‰‡è§„åˆ™é…ç½®ï¼ŒåŒ…å«äº†ç”¨äºè®¾ç½®çœŸå®æ•°æ®èŠ‚ç‚¹çš„ actualDataNodesï¼›ç”¨äºè®¾ç½®åˆ†åº“ç­–ç•¥çš„ databaseShardingStrategyConfigï¼›ä»¥åŠç”¨äºè®¾ç½®åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„è‡ªå¢åˆ—ç”Ÿæˆå™¨çš„ keyGeneratorConfigã€‚å‰é¢å·²ç»åœ¨ ShardingRuleConfiguration ä¸­è®¾ç½®äº†é»˜è®¤çš„ databaseShardingStrategyConfigï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å®Œæˆå‰©ä¸‹çš„ actualDataNodes å’Œ keyGeneratorConfig çš„è®¾ç½®ã€‚</p>
<p>å¯¹äº health_record è¡¨è€Œè¨€ï¼Œç”±äºå­˜åœ¨ä¸¤ä¸ªæ•°æ®æºï¼Œæ‰€ä»¥ï¼Œå®ƒæ‰€å±äºçš„ actual-data-nodes å¯ä»¥ç”¨è¡Œè¡¨è¾¾å¼ ds$-&gt;{0..1}.health_record æ¥è¿›è¡Œè¡¨ç¤ºï¼Œä»£è¡¨åœ¨ ds0 å’Œ ds1 ä¸­éƒ½å­˜åœ¨è¡¨ health_recordã€‚è€Œå¯¹äº keyGeneratorConfig è€Œè¨€ï¼Œé€šå¸¸å»ºè®®ä½ ä½¿ç”¨é›ªèŠ±ç®—æ³•ã€‚æ˜ç¡®äº†è¿™äº›ä¿¡æ¯ä¹‹åï¼Œhealth_record è¡¨å¯¹åº”çš„ TableRuleConfiguration é…ç½®ä¹Ÿå°±é¡ºç†æˆç« äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_record.actual-data-nodes=ds$-&gt;{0..1}.health_record
</span></span><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_record.key-generator.column=record_id
</span></span><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_record.key-generator.type=SNOWFLAKE
</span></span><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_record.key-generator.props.worker.id=33
</span></span></code></pre></td></tr></table>
</div>
</div><p>åŒæ ·çš„ï¼Œhealth_task è¡¨çš„é…ç½®ä¹Ÿå®Œå…¨ç±»ä¼¼ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ key-generator.column çš„å…·ä½“æ•°æ®åˆ—ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_task.actual-data-nodes=ds$-&gt;{0..1}.health_task
</span></span><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_task.key-generator.column=task_id
</span></span><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_task.key-generator.type=SNOWFLAKE
</span></span><span class="line"><span class="cl">spring.shardingsphere.sharding.tables.health_task.key-generator.props.worker.id=33
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®©æˆ‘ä»¬é‡æ–°æ‰§è¡Œ HealthRecordTest å•å…ƒæµ‹è¯•ï¼Œå¹¶æ£€æŸ¥æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¯ ds0 ä¸­çš„ health_record å’Œ health_task è¡¨ï¼š</p>
<p>ds0 ä¸­ health_record è¡¨æ•°æ®</p>
<p>ds0 ä¸­ health_task è¡¨æ•°æ®</p>
<p>è€Œè¿™å¼ å›¾æ˜¯ ds1 ä¸­çš„ health_record å’Œ health_task è¡¨ï¼š</p>
<p>ds1 ä¸­ health_record è¡¨æ•°æ®</p>
<p>ds1 ä¸­ health_task è¡¨æ•°æ®</p>
<p>æ˜¾ç„¶ï¼Œè¿™ä¸¤å¼ è¡¨çš„æ•°æ®å·²ç»æ­£ç¡®è¿›è¡Œäº†åˆ†åº“ã€‚</p>
<p>å°ç»“</p>
<p>ä»æœ¬è¯¾æ—¶å¼€å§‹ï¼Œæˆ‘ä»¬æ­£å¼è¿›å…¥åˆ° ShardingSphere æ ¸å¿ƒåŠŸèƒ½çš„è®²è§£ã€‚ä¸ºäº†ä»‹ç»è¿™äº›åŠŸèƒ½ç‰¹æ€§ï¼Œæˆ‘ä»¬å°†ä»å•åº“å•è¡¨æ¶æ„è®²èµ·ï¼ŒåŸºäºä¸€ä¸ªå…¸å‹çš„ä¸šåŠ¡åœºæ™¯æ¢³ç†æ•°æ®æ“ä½œçš„éœ€æ±‚ï¼Œå¹¶ç»™å‡ºæ•´ä¸ªä»£ç å·¥ç¨‹çš„æ¡†æ¶ï¼Œä»¥åŠåŸºäºæµ‹è¯•ç”¨ä¾‹éªŒè¯æ•°æ®æ“ä½œç»“æœçš„å®ç°è¿‡ç¨‹ã€‚ä»Šå¤©çš„å†…å®¹å…³æ³¨äºå¦‚ä½•å®ç°åˆ†åº“æ“ä½œï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥ ShardingSphere ä¸­å¼ºå¤§çš„é…ç½®ä½“ç³»å®ç°äº†åˆ†åº“æ•ˆæœã€‚</p>
<p>è¿™é‡Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ï¼šå¦‚ä½•ç†è§£ç»‘å®šè¡¨å’Œå¹¿æ’­è¡¨çš„å«ä¹‰å’Œä½œç”¨ï¼Ÿ</p>
<p>åˆ†åº“æ˜¯ ShardingSphere ä¸­åˆ†ç‰‡å¼•æ“çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„åŠŸèƒ½ä¹‹ä¸€ã€‚åœ¨ä¸‹ä¸€è¯¾æ—¶ä¸­ï¼Œæˆ‘ä»¬å°†ç»§ç»­ä»‹ç»åˆ†è¡¨ã€åˆ†åº“+åˆ†è¡¨ä»¥åŠå¼ºåˆ¶è·¯ç”±ç­‰åˆ†ç‰‡æœºåˆ¶ã€‚</p>
<p>-&ndash; ### ç²¾é€‰è¯„è®º ##### **æµ©ï¼š &gt; æˆ‘æ„Ÿè§‰è®²è§£çš„å¾ˆå¥½ï¼Œå¦‚æœèƒ½æŠŠæ–‡ç« ä¸­å¯¹åº”çš„å·¥ç¨‹ä»£ç æä¾›å‡ºæ¥å°±æ›´å¥½å•¦ï½ ###### Â Â Â  ç¼–è¾‘å›å¤ï¼š &gt; Â Â Â  æºç éƒ½åœ¨githubä¸Šï¼šhttps://github.com/tianyilan12/shardingsphere-demo ##### *å…µï¼š &gt; åˆ†åº“ä¹‹åå¦‚ä½•è§£å†³å…³è”æŸ¥è¯¢å’Œæ¨¡ç³ŠæŸ¥è¯¢å‘¢ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  ShardingSphereå¯¹äºæ™®é€šçš„å…³è”æŸ¥è¯¢å’Œæ¨¡ç³ŠæŸ¥è¯¢æ˜¯é€æ˜çš„ï¼Œä¼šåŸºäºè¾“å…¥çš„SQLè¯­å¥è‡ªåŠ¨ä»å„ä¸ªåº“ä¸­è·å–ç›®æ ‡æ•°æ®è¿›è¡Œå½’å¹¶ã€‚å½“ç„¶ï¼Œå¯¹æœ‰äº›SQLè¯­å¥æ˜¯æœ‰é™åˆ¶çš„ï¼Œå®˜ç½‘ä¸Šæœ‰è¯´æ˜ã€‚ ##### **æ½®ï¼š &gt; æœªåˆ†ç‰‡æ—¶å‘æ•°æ®åº“ä¸­æ’å…¥å¼å±€æŠ¥é”™è§£å†³æ–¹æ³•ï¼ŒæŠŠspring.shardingsphere.enableè®¾ç½®ä¸ºfalseã€‚å› ä¸ºå¼€å¯å®ƒçš„è¯å¥½åƒè¯»å–æ•°æ®åº“ç›¸å…³ä¿¡æ¯çš„æ–¹å¼å˜äº†ï¼Œéœ€è¦é€šè¿‡ spring.shardingsphere.datasourceæ¥è®¾å®šã€‚ã€‚ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  å¯¹çš„ï¼Œå¦‚æœä¸åˆ†ç‰‡å°±ä¸è¦å¯åŠ¨shardingsphereï¼Œshardingsphereä¼šæ‹¦æˆªåŸæœ‰sqlåšå¯¹åº”çš„å¤„ç† ##### *æ³¢ï¼š &gt; é…ç½®äº†åˆ†åº“ç­–ç•¥spring.shardingsphere.sharding.default-database-strategy.inline.algorithm-expression=ds$-{user_id % 2}ä½†æ˜¯å‘ç°ï¼Œåœ¨ ds0 ä¸­çš„ userè¡¨ä¸­å±…ç„¶æœ‰user_id=7å’Œuser_id=9çš„æ•°æ®ã€‚æŒ‰é“ç†æ˜¯åº”è¯¥å‡ºç°åœ¨ ds1ä¸­çš„å‘€ã€‚è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ ##### **è¶…ï¼š &gt; è€å¸ˆï¼Œæ‚¨å¥½ï¼Œæˆ‘æŒ‰ç…§æ‚¨çš„æ“ä½œé‡åˆ°äº†ä¸ª ERROR 10002(C1000)ï¼š2Unknown exceptionï¼š[null]ï¼Œè¯·æ•™ä¸‹ è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„ï¼Œä¸€ç›´æ²¡æŸ¥åˆ°è§£å†³åŠæ³•ï¼Ÿå¦å¤– åªåˆ†è¡¨ä¸åˆ†åº“ ä½†æœ‰äº›è¡¨æ˜¯å•è¡¨çš„ï¼Œè¯¥å¦‚ä½•é…ç½®ï¼Ÿ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  å…·ä½“é—®é¢˜è¦çœ‹ä¸€ä¸‹ï¼Œåªåˆ†è¡¨å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬çš„è¯¾ç¨‹é‡Œæœ‰ç›¸å…³çš„æè¿°å’Œç¤ºä¾‹ä»£ç  ##### **å³°ï¼š &gt; mysql æˆ‘èƒ½ç™»å½•ä¸Šå»ã€‚ ##### *äºšï¼š &gt; è¯·é—®è€å¸ˆï¼ŒShardingSphereä¸æ”¯æŒæ‰¹é‡æ›´æ–°å—ï¼Ÿ æœ‰ä»€ä¹ˆæŠ˜ä¸­è§£å†³åŠæ³• ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  åº”è¯¥æ˜¯æ”¯æŒæ‰¹é‡æ›´æ–°çš„ ##### **å›½ï¼š &gt; é‹è¡Œé€™å€‹spring.profiles.active=traditionalå ±éŒ¯äº†ï¼Œå“ªè£å•é¡Œï¼ŸCaused by: java.lang.IllegalArgumentException: Data sources cannot be empty. ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  ç¡®è®¤ä¸€ä¸‹æ•°æ®åº“åœ°å€æ˜¯å¦è®¾ç½®æ­£ç¡® ##### **åˆï¼š &gt; è€å¸ˆæ‚¨å¥½ï¼Œåœ¨åšsaasç³»ç»Ÿæ—¶ï¼Œåªåˆ†åº“ä¸åˆ†è¡¨ï¼Œä½†æ˜¯é…ç½®å¼ºåˆ¶è·¯ç”±ç­–ç•¥æ—¶ï¼Œéœ€è¦ç»‘åœ¨å…·ä½“è¡¨çš„ç­–ç•¥ï¼Œå¦‚æœè¡¨å¤šçš„æ—¶å€™å°±éœ€è¦é…ç½®å¾ˆå¤šä¿¡æ¯ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•çš„æ–¹æ³•ï¼Œåªéœ€è¦é…ç½®åˆ†åº“çš„å¼ºåˆ¶è·¯ç”±ç­–ç•¥å³å¯ï¼Œä¸ç”¨é…ç½®å…·ä½“çš„è¡¨å‘¢ï¼Ÿ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  å¼ºåˆ¶è·¯ç”±æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®åº“æä¾›çš„Hintæœºåˆ¶ï¼Œæˆ‘ç†è§£Hintæœºåˆ¶åº”è¯¥æ˜¯è¦å’Œè¡¨ä¸€èµ·æ‰èƒ½è¿ä½œçš„ ##### **ç”¨æˆ·1024ï¼š &gt; Failed to configure a DataSource: &lsquo;url&rsquo; attribute is not specified and no embedded datasource could be configured.æºç æŠ¥è¿™ä¸ªé—®é¢˜ ï¼Œä½†å®é™…æˆ‘çœ‹éƒ½é…ç½®äº† ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  æ˜¯å“ªä¸ªä»£ç ç¤ºä¾‹å‡ºç°é—®é¢˜ï¼Ÿ ##### **å¤ï¼š &gt; è€å¸ˆä½ å¥½ï¼Œè¯·æ•™ä¸‰ä¸ªé—®é¢˜ï¼š1ã€å¯¹å­˜é‡æ•°æ®å¤§è¡¨å¦‚è®¢å•è¡¨ï¼Œæ€ä¹ˆé€šè¿‡ShardingSphereè¿›è¡Œåˆ†åº“åˆ†è¡¨å­˜å‚¨ï¼Ÿ2ã€ç±»æ¯”æ­¤å°èŠ‚demoï¼Œå¦‚æœåŒæ—¶å­˜åœ¨å¤šå¯¹ç»‘å®šè¡¨ å¦‚health_record/health_taské‡‡ç”¨user_idåˆ†ç‰‡ã€order/order_itemé‡‡ç”¨order_idåˆ†ç‰‡ï¼Œé‚£ä¹ˆåˆ†ç‰‡é”® è¦åˆ†åˆ«æ€ä¹ˆæŒ‡å®šï¼Œå› ä¸ºæ„Ÿè§‰spring.shardingsphere.sharding.default-database-strategy.inline.sharding-column åœ¨å­˜åœ¨ä¸€å¯¹ç»‘å®šè¡¨çš„è¯è¿˜å¥½è¯´ï¼Œå¦‚æœå­˜åœ¨å¤šå¯¹ç»‘å®šè¡¨è¿™ç§è®¾ç½®æ–¹å¼ä¸èƒ½å°†åˆ†ç‰‡é”®ä¸å…·ä½“ç›¸å…³çš„ç»‘å®šè¡¨è¿›è¡Œè”ç³»3ã€ç±»æ¯”æ­¤å°èŠ‚demoï¼Œhealth_record/health_task å‚ä¸åˆ†ç‰‡å› è€Œè¿›è¡Œåˆ†ç‰‡è®¾ç½®ï¼Œå¯å¦‚æœuserè¡¨ ä¸éœ€è¦è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆå¤„ç†ï¼Ÿå½“å‰ç›´æ¥æ“ä½œuser è¿›è¡Œæ’å…¥æ˜¯ä¼šæŠ¥é”™çš„ã€Missing the data source name: &rsquo;null&rsquo;ã€‘ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  1.è¿™ä¸ªç›´æ¥ä½¿ç”¨ShardingSphereçš„åˆ†åº“åˆ†è¡¨åŠŸèƒ½å³å¯ 2.åˆ†åˆ«è®¾ç½®å¤šç»„ç»‘å®šè¡¨å’Œåˆ†ç‰‡é”® 3.åº”è¯¥æ˜¯å¯ä»¥ç›´æ¥æ’å…¥userçš„ï¼ŒæŠ¥é”™æ„Ÿè§‰æ˜¯æ•°æ®æºè®¾ç½®é—®é¢˜ï¼Œä¸æ˜¯æœºåˆ¶é—®é¢˜ ##### **è¾‰ï¼š &gt; userè¡¨ä¸éœ€è¦åˆ†åº“ä¹ˆ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  è¿™é‡Œæ¡ˆä¾‹æ˜¯æ¼”ç¤ºçš„æ˜¯health_recordå’Œhealth_taskçš„åˆ†åº“ï¼Œä¸æ˜¯é’ˆå¯¹userè¡¨çš„ï¼Œuserè¡¨å½“ç„¶ä¹Ÿå¯ä»¥åˆ†åº“ ##### *æ™¨ï¼š &gt; è€å¸ˆï¼Œå¤§è¡¨çš„æ•°æ®ä¹Ÿä¼šåˆ†è¡¨è‡ªåŠ¨è¿ç§»è¿‡å»å— ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  åˆ†è¡¨å°±æ˜¯ä¸ºäº†è§£å†³å¤§è¡¨çš„æ•°æ®å’¯ ##### *æ¶›ï¼š &gt; key-generator.props.worker.idæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œä¸ºä»€ä¹ˆæ˜¯33 ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  è¿™æ˜¯æ˜¯é›ªèŠ±ç®—æ³•ä¸­çš„ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šworkeridçš„ï¼Œè¿™ä¸ª33åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦è®¾ç½®ï¼Œå¯ä»¥å‚è€ƒç¬¬14è¯¾æ—¶çš„å†…å®¹ ##### **æ™–ï¼š &gt; æ·»åŠ äº†shardingsphereä»¥åæ€ä¹ˆé€šè¿‡mybatis @DataSourceæ‰‹åŠ¨åˆ‡æ¢æ•°æ®æº ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  è¿™ä¸ªæˆ‘ç†è§£æ‰€æœ‰DataSourceéƒ½åº”è¯¥ç”±ShardingSphereæ¥ç»Ÿä¸€ç®¡ç†äº†ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¸åº”è¯¥å†é€šè¿‡å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ç±»åˆ‡æ¢æ•°æ®æº ##### **4562ï¼š &gt; åˆ†è¡¨åˆ†åº“ä¹‹åæ€ä¹ˆåˆ†é¡µå‘¢ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  ShardingSphereè‡ªåŠ¨é›†æˆäº†åˆ†é¡µæœºåˆ¶çš„ï¼Œå¯ä»¥çœ‹åé¢çš„â€œå½’å¹¶å¼•æ“â€ç›¸å…³çš„å†…å®¹ ##### **5052ï¼š &gt; æˆ‘çœ‹äº†ä¸€ä¸‹ç»‘å®šè¡¨çš„é…ç½®ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç»‘å®šè¡¨çš„è¯ï¼Œé…ç½®èµ·æ¥ä¸æ˜¯éå¸¸çš„å¤šï¼Ÿ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  æ˜¯çš„ï¼Œé’ˆå¯¹æ¯ä¸ªç»‘å®šè¡¨éƒ½éœ€è¦é…ç½®ã€‚ä¸€èˆ¬ä¸€ä¸ªç³»ç»Ÿä¸­ï¼ŒçœŸæ­£ç”¨åˆ°åˆ†åº“åˆ†è¡¨çš„è¡¨ä¸ä¼šå¤ªå¤šçš„ï¼Œå¤ªå¤šçš„è¯å°±ä¸é€‚åˆç”¨å…³ç³»å‹æ•°æ®åº“äº†ï¼Œæ‰€ä»¥ç»‘å®šè¡¨ä¹Ÿéƒ½æœ‰é™ã€‚ ##### **å¤ï¼š &gt; Missing the data source name: &rsquo;null&rsquo;è¿™ä¸ªé”™çš„åŸå› æ˜¯éœ€è¦æ’å…¥æ•°æ®çš„è¡¨æ²¡æœ‰åœ¨ &ldquo;spring.shardingsphere.sharding.tables&rdquo; é…ç½®å¯¹åº”çš„è¡¨ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  è¿™ä¸ªdatasource nameä¸ºnullåº”è¯¥æ˜¯æ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¸æ˜¯æ•°æ®è¡¨ä¸å­˜åœ¨ ##### **å¨ï¼š &gt; åŸæ¨¡åŸæ ·çš„ä»£ç æ‹‰ä¸‹æ¥è·‘ä¸äº†å•Š,2020-10-08 20:21:12.839 nested exception is java.lang.IllegalArgumentException: qualifiedColumns is required. ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  æˆ‘ä»¬çš„demoä¸­æ˜¯æœ‰ä¸€äº›SQLè„šæœ¬çš„ï¼Œéœ€è¦å…ˆæ‰§è¡Œã€‚è¯·åŒå­¦åœ¨è·‘ä»£ç ä¹‹å‰æ‰§è¡Œä¸€ä¸‹æ•°æ®åº“è„šæœ¬ã€‚ ##### *å•Šï¼š &gt; å¦‚ä½•åšå‚ç›´åˆ†åº“åçš„è·¨åº“è¿è¡¨æŸ¥è¯¢ï¼Ÿ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  åŸºæœ¬çš„è·¨åº“è¿è¡¨æŸ¥è¯¢ShardingSphereéƒ½å·²ç»å¸®å¿™å¤„ç†å¥½äº†ï¼Œå†…éƒ¨ä½¿ç”¨äº†è·¯ç”±å’Œå½’å¹¶ç­‰æœºåˆ¶ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰SQLéƒ½å¯ä»¥åšå¾—åˆ°ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å®˜ç½‘ä¸Šçš„ä½¿ç”¨è¯´æ˜ï¼Œä¸Šé¢æœ‰ä½¿ç”¨ä¸Šçš„ä¸€äº›é™åˆ¶æ¡ä»¶ ##### *å•Šï¼š &gt; è¯·é—®ï¼Œå¦‚ä½•åšåˆ°åªåˆ†åº“ä¸åˆ†è¡¨ï¼Ÿå¦‚orderè¡¨åªåœ¨è®¢å•åº“ï¼Œgoodsè¡¨åªåœ¨å•†å“åº“ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  åªåˆ†åº“çš„è¯å°±é‡‡ç”¨åªé‡‡ç”¨æ–‡ç« ä¸­æåˆ°çš„åˆ†åº“ç­–ç•¥å°±å¯ä»¥äº†ï¼Œæ˜¯æœ€ç®€å•çš„ä¸€ç§æ–¹å¼ ##### *å•Šï¼š &gt; ç»‘å®šè¡¨è®¾ç½®ï¼šå¦‚æœaã€bäº’ä¸ºç»‘å®šè¡¨ cã€däº’ä¸ºç»‘å®šè¡¨ï¼Œæ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  å°±åˆ†åˆ«è®¾ç½®ä¸¤å¯¹ç»‘å®šè¡¨å…³ç³»å°±å¥½äº†ï¼Œaå’Œbæ˜¯ä¸€å¯¹ï¼Œcå’Œdæ˜¯ä¸€å¯¹ ##### **å¹³ï¼š &gt; æä¾›çš„æºç  traditionalé…ç½®æ–‡ä»¶ä¹Ÿè¦æŒ‡å®šdatasource.namesç­‰å±æ€§ï¼Œä¸ç„¶ä¼šæŠ¥datasource is empty ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  å¯¹çš„ï¼Œå¦‚æœç”¨åˆ°è¿™ä¸ªé…ç½®æ–‡ä»¶çš„è¯ä¹Ÿè¦é…ç½®çš„ ##### **2538ï¼š &gt; æˆ‘åœ¨ä½¿ç”¨application-sharding-databases.propertiesé…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼ŒæŠ¥äº†ä»¥ä¸‹é”™è¯¯ï¼Œè¯·å¸®å¿™çœ‹çœ‹æ˜¯ä»€ä¹ˆåŸå› ï¼šException in thread &ldquo;main&rdquo; org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.exceptions.PersistenceException:### Error updating database. Cause: java.lang.IllegalStateException: Missing the data source name: &rsquo;null&rsquo;### The error may involve defaultParameterMap### The error occurred while setting parameters### SQL: INSERT INTO user (user_id, user_name) VALUES (?, ?)### Cause: java.lang.IllegalStateException: Missing the data source name: &rsquo;null&rsquo; at org.mybatis.spring.MyBatisExceptionTranslator.translateExceptionIfPossible(MyBatisExceptionTranslator.java:79) ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  è¿™ä¸ªåº”è¯¥è¿˜æ˜¯ç¬¬ä¸‰æ–¹çš„æ•°æ®æºçš„å®ç°åº“å¼•ç”¨æœ‰é—®é¢˜ï¼Œå¤§æ¦‚ç‡æ•°æ®æºå·¥å…·ç‰ˆæœ¬é—®é¢˜ ##### **9434ï¼š &gt; org.springframework.beans.factory.BeanCreationException: Error creating bean with name &lsquo;dataSource&rsquo; defined in class path resource [org/apache/shardingsphere/shardingjdbc/spring/boot/SpringBootConfiguration.class]è¯·æ•™ä¸‹è¿™ä¸ªDataSourceä¸ºç©ºæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿä»£ç ä»gitä¸Šæ‹‰ä¸‹æ¥çš„ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  è¿™ä¸ªé—®é¢˜å¾ˆå¤§ç¨‹åº¦æ˜¯æ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹DataSourceåº“ç‰ˆæœ¬çš„é—®é¢˜ï¼Œç¡®è®¤ä¸€ä¸‹gitä¸Šæ‹‰ä¸‹æ¥çš„ä»£ç ä¸­æ‰§è¡Œçš„æ˜¯å“ªéƒ¨åˆ†åŠŸèƒ½ï¼Œä¸è¦ä¿®æ”¹ç¬¬ä¸‰æ–¹å·¥å…·åº“çš„ç‰ˆæœ¬ ##### **ç‹ï¼š &gt; æŒ‰è¯¾ç¨‹é…ç½®å®Œ insertçš„æ—¶å€™æŠ¥ç©ºæŒ‡é’ˆï¼Œåº”è¯¥æ˜¯æ‰¾ä¸åˆ°driverClassNameï¼Œçœ‹ä¸å‡ºæ¥å•¥é—®é¢˜ğŸ˜‚ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  æ‰¾ä¸åˆ°driverClassNameçš„è¯ï¼Œéœ€è¦åœ¨mavenä¸­æ·»åŠ Druidç­‰ç›¸å…³çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚å¦‚æœæ·»åŠ ä¹‹åè¿˜æ˜¯æŠ¥é”™ï¼Œé‚£éœ€è¦æ³¨æ„æ¡†æ¶çš„ç‰ˆæœ¬ã€‚å¦‚æœæ¡†æ¶å·²ç»æ·»åŠ äº†ç‰ˆæœ¬ä¹Ÿå’Œæ¡ˆä¾‹ä¸­çš„ä¸€è‡´ï¼Œåº”è¯¥æ˜¯å¯ä»¥è¿è¡Œçš„ã€‚ ##### **å¼€æŒ‚ï¼š &gt; è¿™ç« èŠ‚ä¸­health_recordå’Œhealth_taskä¸­çš„æ•°æ®éƒ½æ˜¯æ ¹æ®userIdå¯¹2å–æ¨¡è¿›è¡Œåˆ†åº“çš„å§ï¼Ÿuserè¡¨ä¸­æ’å…¥æ•°æ®æ˜¯éšæœºåˆ†é…çš„ï¼Ÿ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  æ˜¯çš„ï¼Œæ˜¯å¯¹userIdå¯¹2å–æ¨¡ï¼Œuserè¡¨ä¸­æ’å…¥çš„æ•°æ®æ˜¯æ¨¡æ‹Ÿçš„æ•°æ®ï¼Œä»£ç ä¸­æœ‰å…·ä½“çš„æ•°æ®æ„å»ºæ–¹å¼ ##### **ç³»æ˜¯æ·±äº•å†°ï¼š &gt; health_levelè¡¨åœ¨æ–°å¢çš„æ—¶å€™ä¼šåŒæ—¶æ’å…¥åˆ°å¤šä¸ªåº“é‡Œé¢ä¹ˆï¼Ÿ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  æ˜¯çš„ ##### *æ¬¢ï¼š &gt; è¯·æ•™è€å¸ˆï¼Œå¦‚æœè¯´ç»‘å®šè¡¨çš„åˆ†ç‰‡é”®å¿…é¡»ä¸€è‡´çš„è¯ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç‰¹åˆ«æŒ‡æ˜ç»‘å®šå…³ç³»å‘¢ï¼Ÿç›´æ¥ç”¨å„è‡ªçš„åˆ†ç‰‡é”®ç›´æ¥åˆ¤æ–­ä¸å°±å¥½äº†å—ã€‚ ###### Â Â Â  è®²å¸ˆå›å¤ï¼š &gt; Â Â Â  å„è‡ªç”¨åˆ†ç‰‡é”®çš„è¯åªæ˜¯é’ˆå¯¹å•ç‹¬ä¸€ä¸ªè¡¨ï¼Œè®¾ç½®ç»‘å®šè¡¨çš„ç›®çš„å°±æ˜¯å‡ å¼ è¡¨é€šè¿‡åŒä¸€ä¸ªåˆ†ç‰‡é”®ç»Ÿä¸€æ“ä½œ</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content"></span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        10100-01-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/shardingsphere%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E7%B2%BE%E8%AE%B2/">ShardingSphereæ ¸å¿ƒåŸç†ç²¾è®²</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E9%9D%A2%E8%AF%95%E5%AE%9D%E5%85%B8/06%E6%A0%91%E5%A6%82%E4%BD%95%E6%B7%B1%E5%BA%A6%E8%BF%90%E7%94%A8%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">06æ ‘ï¼šå¦‚ä½•æ·±åº¦è¿ç”¨æ ‘çš„éå†ï¼Ÿ</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/kubernetes%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90%E4%B8%8E%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/06%E6%97%A0%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8%E5%89%96%E6%9E%90kubernete%E4%B8%9A%E5%8A%A1%E5%89%AF%E6%9C%AC%E5%8F%8A%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">
            <span class="next-text nav-default">06æ— çŠ¶æ€åº”ç”¨ï¼šå‰–æKuberneteä¸šåŠ¡å‰¯æœ¬åŠæ°´å¹³æ‰©å±•åº•å±‚åŸç†</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2024 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FVZ07KBD4X"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FVZ07KBD4X');
        }
      </script>






</body>
</html>
